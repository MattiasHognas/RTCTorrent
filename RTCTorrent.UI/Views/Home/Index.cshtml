@model List<RTCTorrent.UI.Models.TorrentModel>

@{
    ViewBag.Title = "RtcTorrent";
}

@section Scripts {
    <script src="@Url.Content("~/Scripts/knockout-2.2.1.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.signalR-1.0.1.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/signalR/hubs")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/Configuration.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/User.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/Peer.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/Client.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/Torrent.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/typings/custom/FileContent.js")" type="text/javascript"></script>
    <script type="text/javascript">
        var client = new RtcTorrent.Client();
        @foreach (var item in Model)
        {
            @* TODO: handle this in ajax requests on listing of "torrents" *@
            <text>client.trackerFiles.push(
            {
                id: '@item.Id',
                name: '@item.Name',
                seeders: '@item.Seeders',
                leechers: '@item.Leechers',
                files: ['@string.Join("','", item.Files)']
            });</text>
        }
        ko.applyBindings(client);
    </script>
}

<script type="text/html" id="localFiles-template">
    <div>Peers</div>
    <ul data-bind="foreach: peers()">
        <li data-bind="text: $data.id()"></li>
    </ul>
    <div>Filenames</div>
    <ul data-bind="foreach: fileNames()">
        <li data-bind="text: $data"></li>
    </ul>
</script>

<script type="text/html" id="trackerFiles-template">
    <div data-bind="text: $data.id(), click: $parent.loadTorrent($data.id())"></div>
</script>

<div>My files</div>
<div>
    <!-- ko foreach: torrents()-->
    <div data-bind="template: { name: 'localFiles-template' }"></div>
    <!-- /ko -->​
</div>

<div>Tracker files</div>
<div>
    <!-- ko foreach: trackerFiles()-->
    <div data-bind="template: { name: 'trackerFiles-template' }"></div>
    <!-- /ko -->​
</div>
