var observableArray,RtcTorrent;(function(n){"use strict";var r=function(){function n(n,i,r,u,f,e){this.id=ko.observable(),this.name=ko.observable(),this.size=ko.observable(),this.seeders=ko.observable(),this.leechers=ko.observable(),this.files=ko.observableArray(),this.id(n),this.name(i),this.seeders(r),this.leechers(u),this.size(f);var o=this;ko.utils.arrayForEach(e,function(n){o.files.push(new t(n.fullPath,n.size,n.hashes))})}return n}(),t,i;n.TrackerTorrent=r,t=function(){function n(n,t,i){this.fullPath=ko.observable(n),this.size=ko.observable(t),this.hashes=ko.observableArray(i)}return n}(),n.TrackerTorrentFile=t,i=function(){function t(n,t){this.fs=null,this.client=n,this.trackerTorrent=t,this.peers=ko.observableArray([]),this.files=ko.observableArray([]),this.readyToServe=ko.observable(!1),this.loadFiles(t)}return t.prototype.quotaError=function(n){var t="";switch(n.code){case 10:t="INVALID_STATE_ERR";break;case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}console.log("Error: "+t,n)},t.prototype.loadFiles=function(t){var i=this;i.client.configuration.requestQuota(window.PERSISTENT,t.size(),function(r){console.log("Quota is available. Quota size: "+r),i.client.configuration.requestFileSystem(window.PERSISTENT,i.trackerTorrent.size(),function(r){i.fs=r,i.fs.root.getDirectory(t.id(),{create:!0},function(r){for(var f=r.createReader(),u=0;u<t.files().length;u++)i.files.push(new n.FileContent(i,f,t.files()[u].fullPath(),t.files()[u].size(),t.files()[u].hashes()))},function(n){console.log("getDictionary error",n)})},i.quotaError)},i.quotaError)},t.prototype.sendMessage=function(n,t){this.findPeer(t).channel.send(n)},t.prototype.createPeer=function(t){var i=new n.Peer(t,this);this.peers.push(i)},t.prototype.findPeer=function(n){return ko.utils.arrayFirst(this.peers(),function(t){return n===t.id()})},t.prototype.removePeer=function(n){var t=ko.utils.arrayFirst(this.peers(),function(t){return n===t.id()});t&&this.peers.remove(t)},t}(),n.Torrent=i})(RtcTorrent||(RtcTorrent={}))