var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},RtcTorrent;(function(n){"use strict";var t=function(n){function t(t,i){n.call(this,t),this.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this.torrent=null,this.pc=null;var r=this;this.torrent=i,this.pc=this.torrent.client.configuration.createPeerConnection(this.handleConnection),this.handleConnection(),this.pc.onicecandidate=this.onIceCandidate.bind(this)}return __extends(t,n),t.prototype.onJsepOffer=function(n){console.log("got JSEP offer"),this.torrent.client.configuration.setRemoteDescription(this.handleConnection,this.torrent.client.id(),this.id(),this.pc,n),this.answer()},t.prototype.onJsepAnswer=function(n){console.log("got JSEP answer"),this.torrent.client.configuration.setRemoteDescription(this.handleConnection,this.torrent.client.id(),this.id(),this.pc,n),console.log("End of candidates")},t.prototype.onJsepCandidate=function(n){console.log("got JSEP candidate"),this.torrent.client.configuration.addIceCandidate(this.pc,n)},t.prototype.onIceCandidate=function(n){console.log("got ICE candidate"),n.candidate?this.torrent.client.socket.server.jsepCandidate({FromSessionId:this.torrent.client.id(),ToSessionId:this.id(),TorrentId:this.torrent.id(),Message:JSON.stringify({label:n.candidate.sdpMLineIndex,id:n.candidate.sdpMid,candidate:n.candidate.candidate})}):console.log("End of candidates")},t.prototype.start=function(){var n=this;console.log("creating offer"),this.pc.createOffer(function(t){console.log("setting local description"),n.pc.setLocalDescription(t);var i={FromSessionId:n.torrent.client.id(),ToSessionId:n.id(),TorrentId:n.torrent.id(),Message:JSON.stringify(t)};console.log("sending offer",i),n.torrent.client.socket.server.jsepOffer(i)},null,n.mediaConstraints)},t.prototype.answer=function(){var n=this;console.log("creating answer"),this.pc.createAnswer(function(t){console.log("setting local description"),n.pc.setLocalDescription(t);var i={FromSessionId:n.torrent.client.id(),ToSessionId:n.id(),TorrentId:n.torrent.id(),Message:JSON.stringify(t)};console.log("sending answer",i),n.torrent.client.socket.server.jsepAnswer(i)},null,n.mediaConstraints)},t.prototype.handleDataChannel=function(n){console.log("handleDataChannel"),this.addDataChannelEvents(n.channel)},t.prototype.addDataChannelEvents=function(n){console.log("addDataChannelEvents");var t=this;this.channel=n,this.channel.onmessage=function(n){n.data instanceof ArrayBuffer?console.log("incomming arrayBuffer: "+n.data):n.data instanceof Blob?console.log("incomming Blob: "+n.data+", length="+n.data.size):console.log("incomming message: "+n.data)},this.channel.onopen=function(n){console.log("dataChannel onopen",n),t.channelOpened=!0},this.channel.onclose=function(n){console.log("dataChannel onclose",n),t.channelOpened=!1},this.channel.onerror=function(n){console.log("dataChannel onerror",n)},console.log("handleDataChannel")},t.prototype.handleConnection=function(){console.log("handleConnection");var n=this.pc.createDataChannel("datachannel",{reliable:!1});this.addDataChannelEvents(n)},t}(n.User);n.Peer=t})(RtcTorrent||(RtcTorrent={}))